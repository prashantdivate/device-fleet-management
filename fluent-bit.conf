[SERVICE]
    Parsers_File  parsers.conf
    storage.path  /var/lib/fluent-bit
    storage.sync  normal
    storage.metrics on

[INPUT]                           # journald
    Name          systemd
    Tag           sys.*
    Read_From_Tail On
    storage.type  filesystem      # durable buffering

[INPUT]                           # container/text logs if needed
    Name          tail
    Path          /var/log/*.log,/var/lib/docker/containers/*/*-json.log
    Tag           app.*
    Read_From_Tail On
    storage.type  filesystem

[FILTER]
    Name          modify
    Match         *
    Add           device_id  ${MACHINE_ID}
    Add           os_commit  ${OSTREE_COMMIT}
    Add           site       ${SITE}

[OUTPUT]                         # send to your on-prem Loki
    Name          loki
    Match         *
    Host          <LOKI_HOST>
    Port          3100
    Labels        job=mad-device,device_id=${MACHINE_ID},site=${SITE},unit=${SYSTEMD_UNIT}
    Line_Format   json
    Retry_Limit   false

